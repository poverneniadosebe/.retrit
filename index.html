<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Жіночий ретрит «Повернення до себе» • Карпати 11.09–15.09.2025</title>
  <meta name="theme-color" content="#a88bd6" />
  <meta name="description" content="Жіночий ретрит у Карпатах про м’яке повернення до себе: медитації, ранкова йога, стояння на цвяхах, МАК-сесії, трансформаційна гра «Ліла», SPA, джипінг до Синевиру, підйом на гору Гемба. Дбайлива атмосфера, сповільнення, безпека й підтримка. Квитки, трансфер, проживання — у вартості." />

  <!-- Favicon & PWA manifest (ставятся скриптом) -->
  <link id="favicon" rel="icon" href="">
  <link id="appleicon" rel="apple-touch-icon" href="">
  <link id="manifestLink" rel="manifest" href="">

  <!-- performance hints -->
  <link rel="preconnect" href="https://i.ibb.co" crossorigin />
  <link rel="dns-prefetch" href="//i.ibb.co" />
  <link rel="preconnect" href="https://images.weserv.nl" crossorigin />
  <link rel="dns-prefetch" href="//images.weserv.nl" />
  <link rel="preconnect" href="https://cdn.statically.io" crossorigin />
  <link rel="dns-prefetch" href="//cdn.statically.io" />
  <link rel="preconnect" href="https://i0.wp.com" crossorigin />
  <link rel="dns-prefetch" href="//i0.wp.com" />
  <link rel="preconnect" href="https://r.jina.ai" crossorigin />
  <link rel="dns-prefetch" href="//r.jina.ai" />

  <style>
    /* ======= RESET & THEME ======= */
    :root{
      /* нежно-фиолетовый стек */
      --bg-1:#b38de6; --bg-2:#a67bdc; --bg-3:#c3a2ef;
      --glass: rgba(255,255,255,.08);
      --border: #ffffff24;
      --text:#f3eeff; --muted:#e3d9ffcc; --accent:#efe3ff;
      --shadow: 0 18px 40px rgba(0,0,0,.28);
      --radius: 18px;
    }
    *{box-sizing:border-box; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; text-rendering:optimizeLegibility}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family: Arial, Helvetica, sans-serif; line-height:1.6;
      background:
        radial-gradient(1200px 800px at 18% -10%, #d3b4ff55 0%, transparent 60%),
        radial-gradient(1000px 700px at 120% 20%, #be9cff55 0%, transparent 65%),
        linear-gradient(140deg,var(--bg-1),var(--bg-2) 50%, var(--bg-3) 100%);
      overflow-x:hidden;
    }
    body::before{
      content:""; position:fixed; inset:-20%;
      background:
        radial-gradient(60% 40% at 70% 20%, #e7d6ff33 0%, transparent 60%),
        radial-gradient(55% 38% at 20% 80%, #f0e6ff22 0%, transparent 60%);
      filter: blur(42px); z-index:-2; animation: float 42s linear infinite alternate;
    }
    @keyframes float{0%{transform:translate3d(0,0,0)}100%{transform:translate3d(-4%,2%,0) scale(1.06)}}

    /* полотно блискіток */
    #sparkles{ position:fixed; inset:0; z-index:-1; pointer-events:none; }

    .wrap{max-width:980px;margin:0 auto;padding:22px}
    header{text-align:center;padding:28px 0 16px}
    .badge{
      display:inline-block;padding:6px 12px;border-radius:999px;background:var(--glass);
      border:1px solid var(--border); color:var(--muted); font-weight:700; letter-spacing:.08em;
    }
    h1{
      margin:14px auto 8px; font-size:clamp(28px,4.5vw,44px); line-height:1.18;
      font-weight:800; letter-spacing:.3px; text-align:center; text-shadow:0 2px 24px #0006; text-wrap:balance;
      max-width: 900px;
    }
    .sub{
      margin:0 auto 18px; font-size:clamp(14px,2.6vw,18px); color:var(--muted); max-width:900px; text-align:center; text-wrap:pretty;
    }

    /* ======= ГАЛЕРЕЯ ======= */
    .carousel{position:relative;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);background:#2b1f53;margin:0 auto}
    .viewport{position:relative;width:100%; aspect-ratio:16/9; overflow:hidden !important; background:#2b1f53}
    .slides{
      display:flex; width:100%; height:100%; transform:translateX(0);
      transition: transform .5s ease; will-change: transform; user-select:none; touch-action: pan-y;
      overflow:hidden !important;
    }
    .slide{flex:0 0 100%; height:100%; position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden}
    .slide picture, .slide img{width:100%; height:100%; object-fit:cover; object-position:center}
    .slide img{
      image-rendering:auto; -webkit-optimize-contrast:auto; pointer-events:none;
      contain: paint; transform: translateZ(0);
    }
    .viewport::-webkit-scrollbar, .slides::-webkit-scrollbar, .slide::-webkit-scrollbar{width:0;height:0}

    /* loader по центру вьюпорта */
    .loader{
      position:absolute; inset:auto; top:50%; left:50%;
      width:28px; height:28px; border-radius:50%;
      border:3px solid rgba(255,255,255,.35); border-top-color:#fff;
      transform:translate(-50%,-50%); pointer-events:none; z-index:2; display:none;
      animation: spin .8s linear infinite;
      box-shadow: 0 0 0 6px rgba(0,0,0,.12);
    }
    @keyframes spin{
      0%{ transform:translate(-50%,-50%) rotate(0deg) }
      100%{ transform:translate(-50%,-50%) rotate(360deg) }
    }

    .navBtn{
      position:absolute; top:50%; transform:translateY(-50%); width:44px; height:44px; border-radius:50%;
      display:grid; place-items:center; color:#fff; background:rgba(33,20,74,.55);
      border:1px solid #ffffff2a; backdrop-filter: blur(6px); cursor:pointer; opacity:.95;
      transition:transform .15s ease, filter .2s ease;
    }
    .navBtn:hover{transform:translateY(-50%) scale(1.06)}
    .navPrev{left:10px} .navNext{right:10px}
    .dots{position:absolute; left:0; right:0; bottom:10px; display:flex; gap:8px; justify-content:center}
    .dot{width:8px;height:8px;border-radius:50%; background:#ffffff60; box-shadow:0 0 0 2px #0003 inset}
    .dot.active{background:#fff}

    /* ======= КАРТКИ ======= */
    .card{
      background:linear-gradient(180deg, #7f61ba99, #5f4aa899);
      border:1px solid var(--border); border-radius:var(--radius);
      padding:22px clamp(16px, 5vw, 28px); margin:20px auto; backdrop-filter: blur(8px);
      box-shadow:var(--shadow);
      text-align:center;
    }
    .card h2{margin:0 0 12px; font-size:clamp(22px,3.6vw,30px); font-weight:800; letter-spacing:.2px; text-align:center; text-wrap:balance}
    .card p,
    ul.clean{max-width:880px;margin:10px auto; text-align:justify; text-wrap:pretty; word-break:normal; overflow-wrap:normal; hyphens:none}
    .grid2{display:grid; gap:16px}
    @media(min-width:820px){ .grid2{grid-template-columns:1.2fr .8fr} }

    ul.clean{padding:0; list-style:disc inside}
    ul.clean li{margin:10px 0; word-break:normal; overflow-wrap:normal; hyphens:none}

    .pill{display:inline-block; margin:6px 6px 0 0; padding:6px 10px; font-size:14px; border-radius:999px;
      border:1px solid var(--border); color:#f7f2ff; background:#ffffff20}

    /* ======= CTA ======= */
    .price{font-size: clamp(22px, 4.4vw, 34px); margin:0 0 12px; font-weight:800; text-align:center}
    .cta{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center}
    .btn{
      appearance:none; border:0; cursor:pointer; padding:14px 20px; border-radius:14px;
      font-weight:800; letter-spacing:.3px; text-decoration:none; display:inline-flex; align-items:center; gap:10px;
      color:#2d1d55; background:linear-gradient(180deg,#efe3ff,#c9aef7); box-shadow:0 10px 24px #0005, inset 0 1px 0 #fff7;
      transition: transform .12s ease, filter .2s ease;
    }
    .btn:hover{transform:translateY(-1px); filter:saturate(1.04)}
    .btn:active{transform:translateY(0)}
    .btnGhost{color:#f0eaff; background:transparent; border:1px solid #ffffff3a; box-shadow:none; padding:12px 16px}
    .note{color:var(--muted); font-size:14px; text-align:center}

    /* REVEAL */
    .reveal{opacity:0; transform:translateY(14px); transition: all .8s ease}
    .reveal.show{opacity:1; transform:none}

    footer{padding:24px 0 40px; text-align:center; color:#e7dcffcc; font-size:14px}
    a{color:#fff}
    @media (prefers-reduced-motion: reduce){
      body::before{animation:none}
      #sparkles{display:none}
      .reveal{transition:none}
    }
  </style>
</head>
<body>
  <!-- повільні блискітки -->
  <canvas id="sparkles"></canvas>

  <div class="wrap">
    <header class="reveal show">
      <span class="badge">Карпати • 11.09–15.09.2025</span>
      <h1>Жіночий ретрит «Повернення до себе»</h1>
      <p class="sub">медитації, ранкова йога, стояння на цвяхах, МАК-сесії, трансформаційна гра «Ліла»</p>
    </header>

    <!-- ======= ГАЛЕРЕЯ ======= -->
    <section class="carousel reveal" id="gallery" aria-label="Галерея світлин">
      <div class="viewport">
        <div class="slides" id="slides"></div>
        <div class="loader" id="galleryLoader" aria-hidden="true"></div>
      </div>
      <button class="navBtn navPrev" id="prev" aria-label="Попереднє фото" type="button">‹</button>
      <button class="navBtn navNext" id="next" aria-label="Наступне фото" type="button">›</button>
      <div class="dots" id="dots" aria-hidden="true"></div>
    </section>

    <!-- ======= ПРО РЕТРИТ ======= -->
    <section class="card reveal">
      <h2>Про ретрит</h2>
      <p>Ці дні — про <b>тишу всередині</b>, м’яке сповільнення та повернення до себе. Ми створюємо безпечний простір, де можна нарешті видихнути, відчути тіло, помітити справжні потреби й дбайливо дати їм місце.</p>
      <p>Практики підібрані так, щоб зняти напругу, відновити енергію й повернути <b>ясність</b>. Ви зможете прожити емоції, які потребують уваги, і побачити нові рішення — без тиску, з повагою до власного темпу.</p>
      <div style="text-align:center;margin-top:10px">
        <span class="pill">Медитації</span>
        <span class="pill">Ранкова йога</span>
        <span class="pill">Стояння на цвяхах (садху)</span>
        <span class="pill">МАК-сесії</span>
        <span class="pill">Трансформаційна гра «Ліла»</span>
      </div>
    </section>

    <!-- ======= ЩО НА ТЕБЕ ЧЕКАЄ ======= -->
    <section class="card reveal">
      <h2>Що на тебе чекає</h2>
      <ul class="clean">
        <li><b>Медитації</b> — заспокоєння нервової системи, відчуття опори й тепла в тілі.</li>
        <li><b>Гра «Ліла»</b> — м’який спосіб побачити себе збоку, отримати підказки й інсайти для рішень.</li>
        <li><b>Стояння на цвяхах</b> — зустріч зі страхом і вихід у силу через усвідомлене дихання.</li>
        <li><b>Ранкова йога</b> — легкість, баланс, м’яка сила й контакт із собою.</li>
        <li><b>МАК-сесії</b> — відповіді з підсвідомого, ясність наступних кроків.</li>
      </ul>
    </section>

    <!-- ======= Як минає день ======= -->
    <section class="card reveal">
      <h2>Як минає день</h2>
      <p>Ранок — тиша, дихання й йога. День — природа, SPA або подорож Карпатами. Вечір — м’які інтеграційні практики, тепле коло, час для себе.</p>
    </section>

    <!-- ======= ЩО ВХОДИТЬ ======= -->
    <section class="card reveal">
      <h2>Що входить у вартість</h2>
      <ul class="clean">
        <li><b>Квитки на поїзд</b>: виїзд з Одеси о <b>14:41</b> потягом «Одеса—Ужгород», вихід на ст. <b>Воловець</b> о <b>06:30</b>.</li>
        <li><b>Трансфер</b> з Воловця до Пилипця й назад.</li>
        <li><b>Проживання</b> у затишному готелі в Пилипці.</li>
        <li><b>SPA-день</b> для відновлення (сауна/басейн/релакс-зона).</li>
        <li><b>Джипінг</b> Карпатами та <b>подорож до озера Синевир</б>.</li>
        <li><b>Підйом на гору Гемба</b></li>
        <li><b>Щоденні практики</b>: медитації, ранкова йога, стояння на цвяхах, МАК-сесії, «Ліла».</li>
      </ul>
    </section>

    <!-- ======= ПІСЛЯ РЕТРИТУ ======= -->
    <section class="card reveal">
      <h2>Що відчуєш після</h2>
      <p>Більше легкості й внутрішнього спокою. Ближчий контакт із тілом і почуттями. Розуміння, куди рухатися далі — без зайвого шуму, з опорою на себе.</p>
    </section>

    <!-- ======= CTA ======= -->
    <section class="card reveal" id="buy">
      <h2>Бронювання</h2>
      <p class="price">Ціна: <b>15 000 гривень</b> — усе перелічене вище входить у вартість</p>
      <div class="cta">
        <a class="btn" href="https://t.me/irinazerkalo_dushi" target="_blank" rel="noopener" aria-label="Придбати участь у Telegram">💫 Забронювати</a>
      </div>
    </section>

    <footer class="reveal">© 2025 «Повернення до себе». Карпати, Пилипець • 11–15 вересня 2025</footer>
  </div>

  <script>
    /* ================== ICON + MANIFEST ================== */
    const ibbIconPage = "https://ibb.co/WNkz2hXP";

    // helpers
    const LS_TTL_MS = 3*24*60*60*1000; // 3 дні
    const now = () => Date.now();

    function testImage(src, timeout=4000){
      return new Promise((resolve)=>{
        const im = new Image();
        let done = false;
        const timer = setTimeout(()=>{ if(!done){ done=true; resolve(false);} }, timeout);
        im.onload = ()=>{ if(!done){ done=true; clearTimeout(timer); resolve(true);} };
        im.onerror = ()=>{ if(!done){ done=true; clearTimeout(timer); resolve(false);} };
        im.referrerPolicy = "no-referrer";
        im.src = src + (src.includes("?")?"&":"?")+"v="+Math.floor(Math.random()*1e6);
      });
    }
    const weserv = (url, dpr=2) => `https://images.weserv.nl/?url=${encodeURIComponent(url)}&output=webp&dpr=${dpr}&il`;
    const staticallyCdn = (url) => {
      try{
        const u = new URL(url);
        return `https://cdn.statically.io/img/${u.hostname}${u.pathname}?f=webp`;
      }catch(e){ return url; }
    };
    const wpcom = (url) => `https://i0.wp.com/${url.replace(/^https?:\/\//,'')}`;

    async function extractDirectFromIbb(url){
      const naked = url.replace(/^https?:\/\//,'');
      const probes = [
        `https://r.jina.ai/http://${naked}`,
        `https://r.jina.ai/https://${naked}`,
      ];
      for(const probe of probes){
        try{
          const txt = await fetch(probe, {cache:'no-store'}).then(r=>r.text());
          const og = txt.match(/property="og:image"\s+content="([^"]+)"/i);
          if(og && await testImage(og[1])) return og[1];
          const tw = txt.match(/name="twitter:image"\s+content="([^"]+)"/i);
          if(tw && await testImage(tw[1])) return tw[1];
          const m = txt.match(/https?:\/\/i\.ibb\.co\/[^\s"'<>]+\.(?:jpg|jpeg|png|webp)/i);
          if(m && await testImage(m[0])) return m[0];
        }catch(e){}
      }
      return null;
    }
    function ibbId(ibbPageUrl){ return ibbPageUrl.split("/").pop().replace(/\?.*/,''); }

    function lsGet(key){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return null;
        const {v, t} = JSON.parse(raw);
        if(now()-t > LS_TTL_MS){ localStorage.removeItem(key); return null; }
        return v;
      }catch(e){ return null; }
    }
    function lsSet(key, value){
      try{ localStorage.setItem(key, JSON.stringify({v:value, t:now()})); }catch(e){}
    }

    async function resolveIbbOnce(ibbPageUrl){
      const direct = await extractDirectFromIbb(ibbPageUrl);
      if(direct) return direct;

      const id = ibbId(ibbPageUrl);
      for(const ext of ["webp","jpg","jpeg","png"]){
        const guess = `https://i.ibb.co/${id}/${id}.${ext}`;
        if(await testImage(guess)) return guess;
      }
      const via1 = weserv(ibbPageUrl);
      if(await testImage(via1)) return via1;
      const via2 = staticallyCdn(ibbPageUrl);
      if(await testImage(via2)) return via2;
      const via3 = wpcom(ibbPageUrl);
      if(await testImage(via3)) return via3;

      return ibbPageUrl;
    }
    async function resolveIbb(ibbPageUrl){
      const key = "ibb:best:"+ibbId(ibbPageUrl);
      const cached = lsGet(key);
      if(cached && await testImage(cached, 1800)) return cached;
      const best = await resolveIbbOnce(ibbPageUrl);
      lsSet(key, best);
      return best;
    }

    async function getBestIcon(){
      const best = await resolveIbb(ibbIconPage);
      return best;
    }

    (async ()=>{
      const bestIcon = await getBestIcon();
      document.getElementById("favicon").href = bestIcon;
      document.getElementById("appleicon").href = bestIcon;

      const manifest = {
        name: "Жіночий ретрит — Душа без масок",
        short_name: "Ретрит",
        start_url: ".",
        display: "standalone",
        background_color: "#a88bd6",
        theme_color: "#a88bd6",
        icons: [
          { src: bestIcon, sizes: "192x192", type: "image/png", purpose: "any maskable" },
          { src: bestIcon, sizes: "512x512", type: "image/png", purpose: "any maskable" }
        ]
      };
      const blob = new Blob([JSON.stringify(manifest)], {type:"application/manifest+json"});
      const url = URL.createObjectURL(blob);
      document.getElementById("manifestLink").href = url;
    })();

    /* ================== ГАЛЕРЕЯ: стабильная загрузка + лоадер ================== */
    const ibbLinks = [
      "https://ibb.co/mC6tPhyp","https://ibb.co/pjfk24r5","https://ibb.co/N2JyQJ4K",
      "https://ibb.co/4nwV4ZTr","https://ibb.co/N21d2zKz","https://ibb.co/hRh6v8P9",
      "https://ibb.co/nqdZJ9N3","https://ibb.co/DfTSTscH","https://ibb.co/4wYj5C1Q",
      "https://ibb.co/xqL9yq3T","https://ibb.co/0yMLq7hW","https://ibb.co/5gqdrNbV",
      "https://ibb.co/1YRhzJRM","https://ibb.co/kgXK9tMS","https://ibb.co/tMyL5fSc",
      "https://ibb.co/Rpb4ZSCG"
    ];

    const slidesEl = document.getElementById("slides");
    const dotsEl = document.getElementById("dots");
    const loader = document.getElementById("galleryLoader");

    function showLoader(v){ loader.style.display = v ? 'block' : 'none'; }

    function makeFallbacks(base){
      const arr = [base, weserv(base,2), staticallyCdn(base), wpcom(base), weserv(base,3)];
      return [...new Set(arr)];
    }

    function buildSlidesFromResolved(resolved){
      resolved.forEach((src,i)=>{
        const slide = document.createElement("div");
        slide.className = "slide";

        const pic = document.createElement("picture");

        const sWebp = document.createElement("source");
        sWebp.type = "image/webp";
        sWebp.srcset = `${weserv(src,1)} 1x, ${weserv(src,2)} 2x, ${weserv(src,3)} 3x`;
        sWebp.sizes = "(max-width: 980px) 100vw, 980px";

        const img = document.createElement("img");
        img.alt = `Фото ${i+1}`;
        img.loading = i<=1 ? "eager" : "lazy";
        img.decoding = "async";
        img.fetchPriority = i<=1 ? "high" : "auto";
        img.referrerPolicy = "no-referrer";
        img.crossOrigin = "anonymous";
        img.src = src;
        img.srcset = `${src} 1x, ${weserv(src,2)} 2x, ${weserv(src,3)} 3x`;
        img.sizes = "(max-width: 980px) 100vw, 980px";

        img.dataset.loaded = "false";
        const fallbacks = makeFallbacks(src);
        img.dataset.fallbacks = JSON.stringify(fallbacks.slice(1));
        img.addEventListener('load', ()=>{ img.dataset.loaded="true"; if(currentIndex===i) showLoader(false); });
        img.onerror = ()=>{
          try{
            const rest = JSON.parse(img.dataset.fallbacks||"[]");
            if(rest.length){
              const next = rest.shift();
              img.dataset.fallbacks = JSON.stringify(rest);
              img.srcset = `${next} 1x, ${weserv(next,2)} 2x`;
              img.src = next;
            }else{
              img.style.objectFit = 'cover';
              img.style.background = 'linear-gradient(135deg,#7f61ba,#5f4aa8)';
              img.alt = `Фото ${i+1} тимчасово недоступне`;
              img.dataset.loaded="true";
              if(currentIndex===i) showLoader(false);
            }
          }catch(e){}
        };

        pic.appendChild(sWebp); pic.appendChild(img);
        slide.appendChild(pic);
        slidesEl.appendChild(slide);

        const dot = document.createElement("span"); dot.className = "dot"; dotsEl.appendChild(dot);

        if(i<=1){
          const link = document.createElement('link');
          link.rel = 'preload'; link.as = 'image'; link.href = src;
          document.head.appendChild(link);
        }else if(i<=3){
          const link2 = document.createElement('link');
          link2.rel = 'prefetch'; link2.as = 'image'; link2.href = src;
          document.head.appendChild(link2);
        }
      });
    }

    async function resolveAll(links, maxConcurrent=4){
      const out = new Array(links.length);
      let i=0;
      async function worker(){
        while(i<links.length){
          const idx = i++;
          try{ out[idx] = await resolveIbb(links[idx]); }
          catch(e){ out[idx] = links[idx]; }
        }
      }
      const N = Math.max(3, Math.min(maxConcurrent, 6));
      await Promise.all(new Array(N).fill(0).map(worker));
      return out;
    }

    let currentIndex = 0;

    (async ()=>{
      showLoader(true);
      const sources = await resolveAll(ibbLinks, 5);
      buildSlidesFromResolved(sources);
      initCarousel();
      // ждём, пока загрузятся первые 2 кадра или истечёт таймаут
      const firstImgs = [...slidesEl.querySelectorAll('img')].slice(0,2);
      const ok = await Promise.race([
        Promise.all(firstImgs.map(img => img.complete ? Promise.resolve() : new Promise(res => img.addEventListener('load', res, {once:true})))),
        new Promise(res => setTimeout(res, 3000))
      ]);
      showLoader(false);
    })();

    function initCarousel(){
      const prevBtn = document.getElementById('prev');
      const nextBtn = document.getElementById('next');
      const dots = Array.from(document.querySelectorAll('.dot'));

      const total = slidesEl.children.length;
      const goTo = (i)=>{
        currentIndex = (i+total)%total;
        const targetImg = slidesEl.children[currentIndex].querySelector('img');
        if(!(targetImg && targetImg.complete)){
          showLoader(true);
          if(targetImg){
            const hide = ()=>{ showLoader(false); targetImg.removeEventListener('load', hide); targetImg.removeEventListener('error', hide); };
            targetImg.addEventListener('load', hide, {once:true});
            targetImg.addEventListener('error', hide, {once:true});
          }
        }else{
          showLoader(false);
        }
        slidesEl.style.transform = `translateX(-${currentIndex*100}%)`;
        dots.forEach((d,di)=>d.classList.toggle('active', di===currentIndex));
      };
      document.getElementById('prev').addEventListener('click', ()=>goTo(currentIndex-1));
      document.getElementById('next').addEventListener('click', ()=>goTo(currentIndex+1));
      goTo(0);

      // свайп
      let startX=null, delta=0;
      slidesEl.addEventListener('pointerdown', e=>{startX=e.clientX; slidesEl.setPointerCapture(e.pointerId);});
      slidesEl.addEventListener('pointermove', e=>{
        if(startX!=null){
          delta = e.clientX-startX;
          slidesEl.style.transform = `translateX(calc(${-currentIndex*100}% + ${delta}px))`;
        }
      });
      const end = ()=>{
        if(startX!=null){
          const threshold = Math.min(240, slidesEl.clientWidth*0.18);
          if(Math.abs(delta) > threshold) goTo(currentIndex + (delta<0?1:-1)); else goTo(currentIndex);
        }
        startX=null; delta=0;
      };
      slidesEl.addEventListener('pointerup', end);
      slidesEl.addEventListener('pointercancel', end);
      slidesEl.addEventListener('pointerleave', end);

      // блокируем внутренние скроллы у вьюпорта
      const viewport = document.querySelector('.viewport');
      ['wheel','touchmove'].forEach(ev=>{
        viewport.addEventListener(ev, ()=>{}, {passive:true});
      });
    }

    /* ================== REVEAL ================== */
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show'); });
    },{threshold:0.14});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    /* ================== SPARKLES ================== */
    const canvas = document.getElementById('sparkles');
    const ctx = canvas.getContext('2d');
    let W=0,H=0, stars=[];
    function resize(){
      const dpr = Math.min(window.devicePixelRatio||1, 2);
      W = canvas.width = Math.floor(innerWidth*dpr);
      H = canvas.height = Math.floor(innerHeight*dpr);
      canvas.style.width = innerWidth+'px';
      canvas.style.height = innerHeight+'px';
      ctx.setTransform(1,0,0,1,0,0);
    }
    function makeStars(n=90){
      stars = new Array(n).fill(0).map(()=>({
        x: Math.random()*W, y: Math.random()*H,
        r: Math.random()*1.6+0.6,
        a: Math.random()*0.5+0.2,
        sp: (Math.random()*0.6+0.3) * 0.004,
        t: Math.random()*Math.PI*2
      }));
    }
    function step(){
      ctx.clearRect(0,0,W,H);
      for(const s of stars){
        s.t += s.sp;
        const alpha = s.a*(0.55+0.45*Math.sin(s.t));
        const g = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r*4);
        g.addColorStop(0, `rgba(255,255,255,${alpha})`);
        g.addColorStop(1, `rgba(255,255,255,0)`);
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(s.x, s.y, s.r*4, 0, Math.PI*2); ctx.fill();
      }
      requestAnimationFrame(step);
    }
    resize(); makeStars(90); requestAnimationFrame(step);
    addEventListener('resize', ()=>{resize(); makeStars(stars.length);});
  </script>
</body>
</html>
